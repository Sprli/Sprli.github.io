<!DOCTYPE html><html class="appearance-light" lang="zh-CN"><head><meta charset="UTF-8"><title>å…³äºåœ¨Jetsonéƒ¨ç½²Yolov5å®ç°æ£€æµ‹ä¸ä¸²å£é€šä¿¡ä¼ é€ä½ç½®ä¿¡æ¯</title><meta name="description" content="No Pain No Gain"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="è¿™ç¯‡åšå®¢ç”¨æ¥è®°å½•å‚åŠ æµ·èµ›C2è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å®ç°åœ¨Jetson Nanoä¸Šéƒ¨ç½²ç›®æ ‡æ£€æµ‹ç®—æ³•ä»¥åŠä½¿ç”¨ä¸²å£é€šä¿¡çš„æ–¹æ³•ã€‚
ç›®æ ‡æ£€æµ‹ç®—æ³•YoloV5
YoloV5çš„ä½¿ç”¨ä¸ç®€å•è®²è§£
Yolov5æ¨¡å‹ç›®å‰åœ¨ç½‘ç»œä¸Šå·²ç»ç»è¿‡äº†è®¸å¤šè€ƒéªŒï¼Œä¸”å…¶Githubå®˜æ–¹ä¹Ÿä»åœ¨ä¸æ–­æ›´æ–°ï¼Œå…¶ç›¸å…³å¹³å°çš„éƒ¨ç½²åœ¨å®˜ç½‘ä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæ‰€ä»¥å¦‚æœæƒ³åœ¨åµŒå…¥å¼å¹³å°éƒ¨ç½²ç›®æ ‡æ£€æµ‹ä»¥åŠåˆ†ç±»ç½‘ç»œï¼Œé€‰æ‹©Yolov5å¯ä»¥å¸¦ç»™æˆ‘ä»¬æå¤§çš„ä¾¿åˆ©ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘é€‰æ‹©ä½¿ç”¨Yolov5çš„åŸå› ã€‚ä»¥ä¸‹å†…å®¹éƒ½æ˜¯åŸºäºYolov5ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„éƒ¨ç½²ã€‚
æ•°æ®é›†çš„æ ‡æ³¨
ä½¿ç”¨Labelimgè¿›è¡Œæ•°æ®æ ‡æ³¨

é¦–å…ˆæ˜¯å®‰è£…labelimg
è¿™é‡Œæ˜¯åœ¨Anacondaç¯å¢ƒä¸‹çš„å®‰è£…

conda create -n label python&amp;#x3D;&amp;#x3D;3.9 # æ³¨æ„è¿™é‡Œå¿…é¡»æ˜¯python3.9ç‰ˆæœ¬ï¼Œå¦åˆ™å®‰.."><script src="//unpkg.com/valine/dist/Valine.min.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">æç¥–ä¹'s blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">å…³äºåœ¨Jetsonéƒ¨ç½²Yolov5å®ç°æ£€æµ‹ä¸ä¸²å£é€šä¿¡ä¼ é€ä½ç½®ä¿¡æ¯</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95YoloV5"><span class="toc-text">ç›®æ ‡æ£€æµ‹ç®—æ³•YoloV5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#YoloV5%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%AE%80%E5%8D%95%E8%AE%B2%E8%A7%A3"><span class="toc-text">YoloV5çš„ä½¿ç”¨ä¸ç®€å•è®²è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E6%A0%87%E6%B3%A8"><span class="toc-text">æ•°æ®é›†çš„æ ‡æ³¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Labelimg%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%A0%87%E6%B3%A8"><span class="toc-text">ä½¿ç”¨Labelimgè¿›è¡Œæ•°æ®æ ‡æ³¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E8%AE%AD%E7%BB%83"><span class="toc-text">è¿›è¡Œè®­ç»ƒ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2%E5%9C%A8Jetson-nano%E4%B8%8A"><span class="toc-text">å°†æ¨¡å‹éƒ¨ç½²åœ¨Jetson nanoä¸Š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%9D%83%E9%87%8D%E7%9A%84%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">æ¨¡å‹æƒé‡çš„æ–‡ä»¶ç±»å‹è½¬æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85ros%EF%BC%8C%E4%BB%A5%E8%BF%9B%E8%A1%8C%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1"><span class="toc-text">å®‰è£…rosï¼Œä»¥è¿›è¡Œä¸²å£é€šä¿¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%A1%86%E6%9E%B6%E2%80%94%E2%80%94DeepStream"><span class="toc-text">é€‰æ‹©æ¡†æ¶â€”â€”DeepStream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%8F%8A%E4%BD%BF%E7%94%A8"><span class="toc-text">è¿è¡ŒåŠä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-text">å¦‚ä½•å®ç°ç¨‹åºè‡ªå¯åŠ¨</span></a></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">å…³äºåœ¨Jetsonéƒ¨ç½²Yolov5å®ç°æ£€æµ‹ä¸ä¸²å£é€šä¿¡ä¼ é€ä½ç½®ä¿¡æ¯</h1><time class="has-text-grey" datetime="2023-06-14T03:27:11.440Z">2023-06-14</time><article class="mt-2 post-content"><p>è¿™ç¯‡åšå®¢ç”¨æ¥è®°å½•å‚åŠ æµ·èµ›C2è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å®ç°åœ¨Jetson Nanoä¸Šéƒ¨ç½²ç›®æ ‡æ£€æµ‹ç®—æ³•ä»¥åŠä½¿ç”¨ä¸²å£é€šä¿¡çš„æ–¹æ³•ã€‚</p>
<h3 id="ç›®æ ‡æ£€æµ‹ç®—æ³•YoloV5">ç›®æ ‡æ£€æµ‹ç®—æ³•YoloV5</h3>
<h4 id="YoloV5çš„ä½¿ç”¨ä¸ç®€å•è®²è§£">YoloV5çš„ä½¿ç”¨ä¸ç®€å•è®²è§£</h4>
<p>Yolov5æ¨¡å‹ç›®å‰åœ¨ç½‘ç»œä¸Šå·²ç»ç»è¿‡äº†è®¸å¤šè€ƒéªŒï¼Œä¸”å…¶Githubå®˜æ–¹ä¹Ÿä»åœ¨ä¸æ–­æ›´æ–°ï¼Œå…¶ç›¸å…³å¹³å°çš„éƒ¨ç½²åœ¨å®˜ç½‘ä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæ‰€ä»¥å¦‚æœæƒ³åœ¨åµŒå…¥å¼å¹³å°éƒ¨ç½²ç›®æ ‡æ£€æµ‹ä»¥åŠåˆ†ç±»ç½‘ç»œï¼Œé€‰æ‹©Yolov5å¯ä»¥å¸¦ç»™æˆ‘ä»¬æå¤§çš„ä¾¿åˆ©ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘é€‰æ‹©ä½¿ç”¨Yolov5çš„åŸå› ã€‚ä»¥ä¸‹å†…å®¹éƒ½æ˜¯åŸºäºYolov5ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„éƒ¨ç½²ã€‚</p>
<h4 id="æ•°æ®é›†çš„æ ‡æ³¨">æ•°æ®é›†çš„æ ‡æ³¨</h4>
<h5 id="ä½¿ç”¨Labelimgè¿›è¡Œæ•°æ®æ ‡æ³¨">ä½¿ç”¨Labelimgè¿›è¡Œæ•°æ®æ ‡æ³¨</h5>
<ul>
<li>é¦–å…ˆæ˜¯å®‰è£…labelimg<br>
è¿™é‡Œæ˜¯åœ¨Anacondaç¯å¢ƒä¸‹çš„å®‰è£…</li>
</ul>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">conda create -n label python&#x3D;&#x3D;3.9 # æ³¨æ„è¿™é‡Œå¿…é¡»æ˜¯python3.9ç‰ˆæœ¬ï¼Œå¦åˆ™å®‰è£…ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨
conda activate label # æ¿€æ´»ç¯å¢ƒ
pip install labelimg # ä½¿ç”¨pipå®‰è£…labelimg
labelimg # è¿™æ˜¯æ‰“å¼€labelimgç•Œé¢çš„æŒ‡ä»¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹åä¼šè¿›å…¥å¦‚ä¸‹ç•Œé¢<br>
<img src="/images/OceanC2/1.png" style="zoom: 100%;" /><br>
è¿™é‡Œä¸»è¦éœ€è¦é…ç½®ä¸Šå›¾ä¸­ä¸‰ä¸ªçº¢åœˆé€‰é¡¹<br>
å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ï¼š<br>
Open Dirï¼šè¿™é‡Œæ˜¯æ‰“å¼€ä½ å­˜æ”¾å›¾ç‰‡çš„æ–‡ä»¶å¤¹<br>
Change Save Dirï¼šè¿™é‡Œæ˜¯ä½ å›¾ç‰‡æ ‡æ³¨çš„æ ‡ç­¾æ•°æ®å­˜æ”¾ä½ç½®<br>
Yoloï¼šè¿™ä¸ªæ˜¯é€‰æ‹©æ ‡æ³¨æ•°æ®çš„æ ¼å¼ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šä¸ªé€‰é¡¹ï¼Œæ ¹æ®è‡ªå·±æ¨¡å‹è®­ç»ƒæ‰€éœ€çš„æ ‡ç­¾ç±»å‹è¿›è¡Œé€‰æ‹©ï¼Œè¿™é‡Œé€‰æ‹©yoloå› ä¸ºæˆ‘è®­ç»ƒçš„æ•°æ®æ ‡ç­¾è¦æ±‚æ˜¯Yoloç±»å‹ã€‚<br>
å½“æŠŠä¸Šè¿°é…ç½®å‡†å¤‡å·¥ä½œå®Œæˆåï¼Œå°±å¯ä»¥å¼€å§‹æ•°æ®æ ‡æ³¨äº†å•¦<br>
<video id="video" controls="" preload="none" poster="å°é¢"><br>
<source id="mp4" src="/videos/labelimg_video1.mp4" type="video/mp4"><br>
</videos><br>
å¦‚ä¸Šè§†é¢‘æ‰€ç¤ºï¼Œå¯¹æ•°æ®è¿›è¡Œæ ‡æ³¨ã€‚è¿™é‡Œä»‹ç»æœ€å¸¸ä½¿ç”¨çš„å¿«æ·é”®ï¼Œå¯ä»¥å¸®åŠ©æ›´å¿«åœ°è¿›è¡Œæ•°æ®æ ‡æ³¨å·¥ä½œï¼š</p>
<ul>
<li>Wé”®ï¼šæ˜¾ç¤ºåå­—å…‰æ ‡ï¼Œå‡ºç°åå­—å…‰æ ‡åå³å¯é…åˆé¼ æ ‡æ¡†ä½ç›®æ ‡</li>
<li>Dé”®ï¼šä¸‹ä¸€å¼ å›¾ç‰‡</li>
<li>Aé”®ï¼šä¸Šä¸€å¼ å›¾ç‰‡</li>
<li>Ctrl+Sé”®ï¼šå¯¹å½“å‰æ“ä½œè¿›è¡Œä¿å­˜</li>
<li>Ctrl+é¼ æ ‡æ»šè½®ï¼šå¯¹å›¾ç‰‡ä¸Šé¼ æ ‡æ‰€æŒ‡åŒºåŸŸè¿›è¡Œæ”¾å¤§å’Œç¼©å°æ“ä½œ<br>
ä¸€èˆ¬æ¥è¯´ï¼ŒçŸ¥é“ä¸Šè¿°å››ç§å¿«æ·é”®å³å¯å¸®åŠ©ä½ è¿›è¡Œå¿«æ·æ ‡æ³¨æ•°æ®å•¦</li>
</ul>
<h5 id="è¿›è¡Œè®­ç»ƒ">è¿›è¡Œè®­ç»ƒ</h5>
<p>åœ¨æ ‡æ³¨å®Œæ•°æ®åï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¸å¿ƒç¯èŠ‚ï¼šè®­ç»ƒæ¨¡å‹<br>
è¿™é‡Œé¦–å…ˆä»Yolov5å®˜æ–¹Githubä¸Šcloneå…¶ä»£ç :<br>
è¿™é‡Œç»™å‡ºå®˜æ–¹é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5">https://github.com/ultralytics/yolov5</a><br>
å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ä¸‹è½½å…¶ä»£ç ï¼š</p>
<ol>
<li>ä½¿ç”¨git cloneå‘½ä»¤ä¸‹è½½ï¼š<br>
<img src="/images/OceanC2/2.png" style="zoom: 100%;" /><br>
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œcopyå½“å‰githubä¸‹è½½é“¾æ¥ï¼Œç„¶ååœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸‹è¾“å…¥å‘½ä»¤ï¼š</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">git clone git@github.com:ultralytics&#x2F;yolov5.git  # è¿™æ¡æŒ‡ä»¤ä¼šåœ¨ä½ çš„å½“å‰è·¯å¾„ä¸‹è½½Yolov5æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœå¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ²¡æœ‰æ‰¾åˆ°gitå‘½ä»¤ï¼Œé‚£ä¹ˆå°±æ˜¯å½“å‰ä½ çš„è™šæ‹Ÿç¯å¢ƒæ²¡æœ‰å®‰è£…gitï¼Œä½¿ç”¨conda install git æˆ–è€… pip install gitå‘½ä»¤è¿›è¡Œå®‰è£…<br>
å¦‚æœå¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ˜¯ç½‘ç»œé—®é¢˜ï¼Œé‚£ä¹ˆå¯èƒ½ä½ éœ€è¦æŒ‚æ¢¯å­æ‰å¯ä»¥ã€‚å¦‚æœä»ç„¶æ— æ³•è§£å†³ï¼Œé‚£ä¹ˆå°±å°è¯•å¼€å…³é‡å¯ã€‚</p>
<ol start="2">
<li>ç›´æ¥ä»å®˜ç½‘ä¸‹è½½zipæ–‡ä»¶ï¼š<br>
<img src="/images/OceanC2/3.png" style="zoom: 100%;" /><br>
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç‚¹å‡»çº¢åœˆé€‰é¡¹ï¼Œä¸‹è½½zipæ–‡ä»¶ï¼Œéšåå°†å…¶è§£å‹å³å¯å¾—åˆ°Yolov5å®˜æ–¹æ–‡ä»¶</li>
</ol>
<p>ç„¶åè¿›å…¥æ–‡ä»¶ç›®å½•ï¼Œåœ¨dataæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªC2.yamlæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"># YOLOv5 ğŸš€ by Ultralytics, AGPL-3.0 license
# COCO128 dataset https:&#x2F;&#x2F;www.kaggle.com&#x2F;ultralytics&#x2F;coco128 (first 128 images from COCO train2017) by Ultralytics
# Example usage: python train.py --data coco128.yaml
# parent
# â”œâ”€â”€ yolov5
# â””â”€â”€ datasets
#     â””â”€â”€ coco128  â† downloads here (7 MB)


# Train&#x2F;val&#x2F;test sets as 1) dir: path&#x2F;to&#x2F;imgs, 2) file: path&#x2F;to&#x2F;imgs.txt, or 3) list: [path&#x2F;to&#x2F;imgs1, path&#x2F;to&#x2F;imgs2, ..]
path: ..&#x2F;datasets&#x2F;coco128  # dataset root dir
train: images&#x2F;train2017  # train images (relative to &#39;path&#39;) 128 images
val: images&#x2F;train2017  # val images (relative to &#39;path&#39;) 128 images
test:  # test images (optional)

# Classes
names:
  0: hole<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ–‡ä»¶è·¯å¾„ä»¥åŠå†…å®¹è¯¦ç»†å‚è€ƒä»¥ä¸‹å›¾ç‰‡ï¼š<br>
<img src="/images/OceanC2/5.png" style="zoom: 100%;" /><br>
å…¶ä¸­ï¼š</p>
<ul>
<li>pathï¼šæ˜¯æŒ‡æ ¹ç›®å½•çš„è·¯å¾„</li>
<li>trainï¼šæ˜¯æŒ‡è¦è®­ç»ƒçš„å›¾ç‰‡å­˜æ”¾ä½ç½®</li>
<li>valï¼šæ˜¯æŒ‡è¦éªŒè¯çš„å›¾ç‰‡å­˜æ”¾ä½ç½®ï¼ˆè¿™é‡Œå’Œtrainä¿æŒä¸€è‡´å³å¯ï¼‰</li>
<li>nameï¼šç±»åˆ«å­˜æ”¾ä½ç½®ï¼Œå¦‚å›¾ä¸­æ‰€ç¤ºï¼š0è¡¨ç¤ºç›®æ ‡ç±»åˆ«ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œholeè¡¨ç¤ºå…¶ä»£è¡¨çš„ç±»åˆ«åç§°</li>
</ul>
<p>è¿™é‡Œå†é™„ä¸Šä¸€å¼ è®­ç»ƒæ•°æ®å­˜æ”¾çš„æ–‡ä»¶å¤¹è·¯å¾„åŠå†…å®¹ï¼š<br>
<img src="/images/OceanC2/6.png" style="zoom:100%;" /><br>
è¿™é‡Œåªéœ€è¦å…³æ³¨ç™½è‰²åœˆä¸­çš„ä¸¤ä¸ªæ–‡ä»¶å¤¹datasetä¸yolov5ï¼Œå…¶ä¸­è·¯å¾„ç›¸å¯¹ä½ç½®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"># parent
# â”œâ”€â”€ yolov5
# â””â”€â”€ datasets
#     â””â”€â”€ coco128
#         â””â”€â”€ images
#             â””â”€â”€ train2017 # æ–‡ä»¶å¤¹ä¸‹æ˜¯è®­ç»ƒå›¾ç‰‡
#         â””â”€â”€ labels
#             â””â”€â”€ train2017 # æ–‡ä»¶å¤¹ä¸‹æ˜¯è®­ç»ƒå›¾ç‰‡å¯¹åº”çš„æ ‡æ³¨æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹åæŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œé…ç½®ä½ çš„è™šæ‹Ÿç¯å¢ƒï¼Œé…ç½®å®Œæˆåå³å¯ä½¿ç”¨ç»ˆç«¯åœ¨å½“å‰è·¯å¾„ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®­ç»ƒï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">python train.py --data C2.yaml --weights yolov5n.pt --cfg yolov5n.yaml --img 640  --batch-size 4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æŒ‡ä»¤è§£é‡Šï¼š</p>
<ul>
<li>â€“dataï¼šC2.yamlä¸ºå‰é¢æ‰€åˆ›å»ºçš„æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯é…ç½®è®­ç»ƒæ•°æ®çš„ç›¸å…³å†…å®¹</li>
<li>â€“weightsï¼š yolov5n.ptæ˜¯æŒ‡ä½¿ç”¨å®˜æ–¹çš„yolov5né¢„è®­ç»ƒæ¨¡å‹æ¥è¿›è¡Œè¿ç§»å­¦ä¹ è®­ç»ƒ</li>
<li>â€“cfgï¼šyolov5n.yamlæ–‡ä»¶æ—¶æ¨¡å‹çš„ç»“æ„æ–‡ä»¶</li>
<li>â€“imgï¼š640æ˜¯æŒ‡é€è¿›æ¨¡å‹è¿›è¡Œè®­ç»ƒçš„å›¾ç‰‡å°ºå¯¸ï¼Œ640è¡¨ç¤º640x640ã€‚æ³¨æ„æ­¤æ•°å­—åº”ä¸º32çš„æ•´æ•°å€ï¼Œä¸ç„¶è®­ç»ƒä¼šå‡ºé”™</li>
<li>â€“batch-sizeï¼š4æ˜¯æŒ‡ä¸€æ¬¡é€å…¥æ¨¡å‹è®­ç»ƒçš„å›¾ç‰‡ä¸ªæ•°ä¸º4ï¼Œè¿™ä¸€é¡¹å’Œä½ çš„GPUæ€§èƒ½ç›¸è”ç³»ï¼Œbatch-sizeè¿‡å¤§ä¼šå¯¼è‡´ä½ çš„GPUå› ä¸ºæ˜¾å­˜ä¸å¤Ÿè€Œæ— æ³•è®­ç»ƒã€‚</li>
</ul>
<p>å¦‚æœä¸Šè¿°å‘½ä»¤è¾“å…¥åæ˜¾ç¤ºé”™è¯¯ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ä½ çš„batch-sizeè®¾ç½®è¿‡å¤§äº†ï¼Œè°ƒå°å³å¯ï¼Œå¦‚2æˆ–1ã€‚<br>
å½“ç„¶è¿˜æœ‰ä¸€ä¸ªå‰ææ˜¯ï¼Œä½ æŒ‰ç…§å®˜æ–¹æ–‡æ¡£æˆåŠŸé…ç½®å¥½äº†ä½ çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚pytorchã€cudaç­‰ã€‚</p>
<p>è®­ç»ƒå®Œæˆåï¼Œä½ çš„æ¨¡å‹å­˜æ”¾åœ¨å¦‚ä¸‹è·¯å¾„ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"># parent
# â”œâ”€â”€ yolov5
#     â””â”€â”€ runs
#         â””â”€â”€ train
#             â””â”€â”€ exp # ä¸ä¸€å®šæ˜¯expï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯exp+ä¸€ä¸ªæ•°å­—
#                 â””â”€â”€ weights
#                     â””â”€â”€ best.pt # è¿™æ˜¯è®­ç»ƒå¾—åˆ°çš„æœ€ä¼˜çš„æƒé‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å°†æ¨¡å‹éƒ¨ç½²åœ¨Jetson-nanoä¸Š">å°†æ¨¡å‹éƒ¨ç½²åœ¨Jetson nanoä¸Š</h3>
<h4 id="æ¨¡å‹æƒé‡çš„æ–‡ä»¶ç±»å‹è½¬æ¢">æ¨¡å‹æƒé‡çš„æ–‡ä»¶ç±»å‹è½¬æ¢</h4>
<p>é¦–å…ˆå°†æ¨¡å‹ç±»å‹è½¬æ¢ä¸ºwtsæ ¼å¼ï¼Œåœ¨yolov5æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªgen_wts.pyæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">import sys
import argparse
import os
import struct
import torch
from utils.torch_utils import select_device


def parse_args():
    parser &#x3D; argparse.ArgumentParser(description&#x3D;&#39;Convert .pt file to .wts&#39;)
    parser.add_argument(&#39;-w&#39;, &#39;--weights&#39;, required&#x3D;True,
                        help&#x3D;&#39;Input weights (.pt) file path (required)&#39;)
    parser.add_argument(
        &#39;-o&#39;, &#39;--output&#39;, help&#x3D;&#39;Output (.wts) file path (optional)&#39;)
    parser.add_argument(
        &#39;-t&#39;, &#39;--type&#39;, type&#x3D;str, default&#x3D;&#39;detect&#39;, choices&#x3D;[&#39;detect&#39;, &#39;cls&#39;, &#39;seg&#39;],
        help&#x3D;&#39;determines the model is detection&#x2F;classification&#39;)
    args &#x3D; parser.parse_args()
    if not os.path.isfile(args.weights):
        raise SystemExit(&#39;Invalid input file&#39;)
    if not args.output:
        args.output &#x3D; os.path.splitext(args.weights)[0] + &#39;.wts&#39;
    elif os.path.isdir(args.output):
        args.output &#x3D; os.path.join(
            args.output,
            os.path.splitext(os.path.basename(args.weights))[0] + &#39;.wts&#39;)
    return args.weights, args.output, args.type


pt_file, wts_file, m_type &#x3D; parse_args()
print(f&#39;Generating .wts for &#123;m_type&#125; model&#39;)

# Load model
print(f&#39;Loading &#123;pt_file&#125;&#39;)
device &#x3D; select_device(&#39;cpu&#39;)
model &#x3D; torch.load(pt_file, map_location&#x3D;device)  # Load FP32 weights
model &#x3D; model[&#39;ema&#39; if model.get(&#39;ema&#39;) else &#39;model&#39;].float()

if m_type in [&#39;detect&#39;, &#39;seg&#39;]:
    # update anchor_grid info
    anchor_grid &#x3D; model.model[-1].anchors * model.model[-1].stride[..., None, None]
    # model.model[-1].anchor_grid &#x3D; anchor_grid
    delattr(model.model[-1], &#39;anchor_grid&#39;)  # model.model[-1] is detect layer
    # The parameters are saved in the OrderDict through the &quot;register_buffer&quot; method, and then saved to the weight.
    model.model[-1].register_buffer(&quot;anchor_grid&quot;, anchor_grid)
    model.model[-1].register_buffer(&quot;strides&quot;, model.model[-1].stride)

model.to(device).eval()

print(f&#39;Writing into &#123;wts_file&#125;&#39;)
with open(wts_file, &#39;w&#39;) as f:
    f.write(&#39;&#123;&#125;\n&#39;.format(len(model.state_dict().keys())))
    for k, v in model.state_dict().items():
        vr &#x3D; v.reshape(-1).cpu().numpy()
        f.write(&#39;&#123;&#125; &#123;&#125; &#39;.format(k, len(vr)))
        for vv in vr:
            f.write(&#39; &#39;)
            f.write(struct.pack(&#39;&gt;f&#39;, float(vv)).hex())
        f.write(&#39;\n&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶ååœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">python gen_wts.py -w .&#x2F;runs&#x2F;train&#x2F;exp&#x2F;weights&#x2F;best.pt -o .&#x2F;best.wts -t detect<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‘½ä»¤è§£é‡Šï¼š</p>
<ul>
<li>-wï¼šæ˜¯æƒé‡æƒé‡å­˜æ”¾ä½ç½®</li>
<li>-oï¼šæ˜¯ç”Ÿæˆçš„wtsç±»å‹æƒé‡çš„åç§°ä»¥åŠå­˜æ”¾è·¯å¾„</li>
<li>-tï¼šæ˜¯æŒ‡å®šä½ çš„æ¨¡å‹ç±»å‹ï¼Œdetectè¡¨ç¤ºç›®æ ‡æ£€æµ‹ç½‘ç»œï¼Œclsè¡¨ç¤ºåˆ†ç±»ç½‘ç»œï¼Œsegè¡¨ç¤ºåˆ†å‰²ç½‘ç»œ<br>
è¿è¡Œå®Œæ¯•åå³å¯å‘ç°åœ¨å½“å‰è·¯å¾„ä¸‹ä»¥åŠç”Ÿæˆäº†ä¸€ä¸ªbest.wtsæ–‡ä»¶</li>
</ul>
<p>ç„¶åæ˜¯å°†wtsæ ¼å¼æ¨¡å‹è½¬æ¢ä¸ºtensorrtæ ¼å¼æ¨¡å‹ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨Githubä¸Šå¼€æºçš„ç›¸å…³å·¥ç¨‹æ–‡ä»¶ï¼Œä½¿ç”¨git cloneå°†å·¥ç¨‹å…‹éš†åˆ°ä»»æ„è·¯å¾„ä¸‹ï¼š<br>
éœ€è¦æ³¨æ„çš„æ˜¯æ¥ä¸‹æ¥çš„æ“ä½œéƒ½æ˜¯åœ¨Jetsonç³»ç»Ÿä¸Šè¿›è¡Œçš„ã€‚<br>
ä½¿ç”¨å‘½ä»¤ï¼ˆæ–¹æ³•åŒä¸Šï¼‰ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">git clone https:&#x2F;&#x2F;github.com&#x2F;wang-xinyu&#x2F;tensorrtx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¯¥å·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"># â”œâ”€â”€ tensorrtx
#     â””â”€â”€ yolov5
#         â””â”€â”€ images
#         â””â”€â”€ best.wts # å°†ä¸Šè¿°ç”Ÿæˆå¾—åˆ°çš„best.wtsæ–‡ä»¶æ”¾å…¥æ­¤è·¯å¾„
#         â””â”€â”€ plugin # é‡Œé¢å­˜æ”¾çš„é€‚åˆyolov5æ¨¡å‹ç»“æ„ç›¸å…³çš„æ–‡ä»¶
#         â””â”€â”€ src # é‡Œé¢æ˜¯æˆ‘ä»¬éœ€è¦ä¿®æ”¹åˆ°çš„æ¨¡å‹è¿è¡Œé…ç½®æ–‡ä»¶
#             â””â”€â”€ config.h
#                 â””â”€â”€ weights
#                     â””â”€â”€ best.pt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹ç»†èŠ‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>config.hï¼šå°†å…¶ä¸­çš„kNumClass = 80ä¿®æ”¹ä¸ºæˆ‘ä»¬æ¨¡å‹è®­ç»ƒä½¿ç”¨çš„ç±»åˆ«æ•°ï¼Œè¿™é‡Œæˆ‘ä¿®æ”¹çš„kNumClass = 2;<br>
ç„¶ååœ¨yolov5è·¯å¾„ä¸‹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†wtsæ ¼å¼æƒé‡æ–‡ä»¶è½¬æ¢ä¸ºengineæ ¼å¼æƒé‡æ–‡ä»¶</li>
</ul>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">mkdir build
cd build
cmake ..
make
sudo .&#x2F;yolov5_det -s ..&#x2F;best.wts ..&#x2F;best.engine n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‘½ä»¤è§£é‡Šï¼š</p>
<ul>
<li>å‰å››è¡Œå‘½ä»¤ï¼šæ˜¯ä½¿ç”¨cmakeç›¸å…³æŒ‡ä»¤å¯¹ç›¸å…³æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œä»¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶yolov5_det</li>
<li>æœ€åä¸€è¡Œå‘½ä»¤ï¼š
<ul>
<li>yolov5_detï¼šç›®æ ‡æ£€æµ‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œyolov5_clsä¸yolov5_segåŒç†ï¼›</li>
<li>-sï¼šåº”è¯¥æ˜¯ä¸€ç§æ¨¡å‹é€‰æ‹©ï¼ˆå³é€‰æ‹©è¿›è¡Œæ¨¡å‹è½¬æ¢æ¨¡å‹ï¼‰ï¼Œâ€¦/best.wtsè¡¨ç¤ºæˆ‘ä»¬å‰é¢æ“ä½œç”Ÿæˆçš„wtsæ ¼å¼æƒé‡æ–‡ä»¶ï¼Œå³æºæ–‡ä»¶ï¼›â€¦/best.engineæ˜¯ç›®æ ‡æ–‡ä»¶ï¼Œå³ç”Ÿæˆè½¬æ¢å¾—åˆ°çš„æ–‡ä»¶</li>
<li>nï¼šæ˜¯æˆ‘ä»¬yolov5æ¨¡å‹çš„ç±»å‹ï¼Œè¿™é‡Œç”±äºæˆ‘é€‰æ‹©ä½¿ç”¨çš„æ˜¯yolov5næ¨¡å‹ï¼Œæ•…ä¸ºnã€‚è¿™é‡Œæ‹“å±•ä¸€ä¸‹è‹¥æ˜¯yolov5mæ¨¡å‹ï¼Œåˆ™æ˜¯mï¼›yolov5læ¨¡å‹ï¼Œåˆ™æ˜¯lï¼›å…¶ä»–ç±»å‹åŒç†å³å¯ã€‚<br>
æ³¨æ„ï¼šå¦‚æœè¿è¡Œå¤±è´¥ï¼Œè¯·ä¸¥æ ¼å¯¹ç…§æ˜¯å¦æŒ‰ç…§ä¸Šè¿°æ“ä½œå¯¹ç›¸å…³æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚<br>
ä¹‹åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ£€éªŒç”Ÿæˆçš„engineæ–‡ä»¶æ˜¯å¦æœ‰é—®é¢˜ï¼š</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">sudo .&#x2F;yolov5_det -d ..&#x2F;best.engine ..&#x2F;samples<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‘½ä»¤è§£é‡Šï¼š</p>
<ul>
<li>-dï¼šè§£é‡ŠåŒä¸Šï¼Œæ˜¯ä¸€ç§æ¨¡å‹é€‰æ‹©ï¼Œå³è¿›è¡Œæµ‹è¯•</li>
<li>â€¦/best.engineï¼šæˆ‘ä»¬ç”Ÿæˆçš„engineæ ¼å¼æ–‡ä»¶è·¯å¾„</li>
<li>â€¦/samplesï¼šæˆ‘ä»¬è¦æ£€æµ‹çš„å›¾ç‰‡å­˜æ”¾è·¯å¾„ï¼Œè¿™é‡Œå¯è‡ªè¡Œåˆ›å»ºè¯¥æ–‡ä»¶å¤¹ï¼Œå¹¶å°†è‡ªå·±çš„å›¾ç‰‡æ”¾å…¥æ­¤æ–‡ä»¶å¤¹<br>
ç›¸å…³è·¯å¾„ï¼š</li>
</ul>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"># â”œâ”€â”€ tensorrtx
#     â””â”€â”€ yolov5
#         â””â”€â”€ images
#         â””â”€â”€ best.wts # å°†ä¸Šè¿°ç”Ÿæˆå¾—åˆ°çš„best.wtsæ–‡ä»¶æ”¾å…¥æ­¤è·¯å¾„
#         â””â”€â”€ best.engine # ç”Ÿæˆçš„engineæ–‡ä»¶
#         â””â”€â”€ samples
#             â””â”€â”€ test1.jpg
#             â””â”€â”€ test2.jpg
#             â””â”€â”€ ...
#         â””â”€â”€ plugin # é‡Œé¢å­˜æ”¾çš„é€‚åˆyolov5æ¨¡å‹ç»“æ„ç›¸å…³çš„æ–‡ä»¶
#         â””â”€â”€ src # é‡Œé¢æ˜¯æˆ‘ä»¬éœ€è¦ä¿®æ”¹åˆ°çš„æ¨¡å‹è¿è¡Œé…ç½®æ–‡ä»¶
#             â””â”€â”€ config.h
#                 â””â”€â”€ weights
#                     â””â”€â”€ best.pt
#         â””â”€â”€ build # cmakeç›¸å…³è¯­å¥åå¾—åˆ°çš„æ–‡ä»¶
#             â””â”€â”€ yolov5_det
#             â””â”€â”€ libmyplugins.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿è¡Œå®Œåï¼Œä¼šåœ¨å½“å‰è·¯å¾„ä¸‹å¾—åˆ°æ£€æµ‹åçš„å›¾ç‰‡ï¼Œå¯ä»¥è‡ªè¡Œè§‚å¯Ÿæ£€æµ‹æ¨¡å‹æ˜¯å¦æœ‰é—®é¢˜ã€‚</p>
<h4 id="å®‰è£…rosï¼Œä»¥è¿›è¡Œä¸²å£é€šä¿¡">å®‰è£…rosï¼Œä»¥è¿›è¡Œä¸²å£é€šä¿¡</h4>
<p>è¿™é‡Œå…ˆé™„ä¸Šjetson nanoçš„å¼•è„šå›¾<br>
<img src="/images/OceanC2/7.png" style="zoom:100%;" /></p>
<h4 id="é€‰æ‹©æ¡†æ¶â€”â€”DeepStream">é€‰æ‹©æ¡†æ¶â€”â€”DeepStream</h4>
<p>é¦–å…ˆéœ€è¦å®‰è£…Deepstreamï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»å®‰è£…Deepstream5.0ç‰ˆæœ¬ï¼Œä¸ç„¶ä»¥ä¸‹æ“ä½œå¯èƒ½æ— æ•ˆï¼Œé™„ä¸Šä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://developer.nvidia.com/deepstream-getting-started">https://developer.nvidia.com/deepstream-getting-started</a><br>
ç„¶åå°±æ˜¯éœ€è¦ä»Githubä¸Šå…‹éš†ä»–äººå¼€æºçš„å·¥ç¨‹æ–‡ä»¶ï¼š<br>
ä½¿ç”¨å‘½ä»¤ï¼ˆæ–¹æ³•åŒä¸Šï¼‰ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">git clone git@github.com:DanaHan&#x2F;Yolov5-in-Deepstream-5.0.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¯¥å·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼ˆè¿™é‡Œåªç»™å‡ºè¦ä¿®æ”¹çš„æ–‡ä»¶ï¼‰ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"># â”œâ”€â”€ Yolov5-in-Deepstream-5.0
#     â””â”€â”€ Deepstream5.0
#         â””â”€â”€ includes
#         â””â”€â”€ nvdsinfer_custom_impl_Yolo
#             â””â”€â”€ nvdsparsebbox_Yolo.cpp
#             â””â”€â”€ Makefile
#         â””â”€â”€ deepstream_app_config_yoloV5.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹ç»†èŠ‚ï¼š</p>
<ul>
<li>è¿›å…¥nvdsparsebbox_Yolo.cppæ–‡ä»¶ï¼Œå…·ä½“ç»†èŠ‚å¦‚ä¸‹<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">...
#include &lt;cstdio&gt;
#include &quot;serial&#x2F;serial.h&quot;
#include &lt;vector&gt;
...

static bool NvDsInferParseYoloV5(
    std::vector&lt;NvDsInferLayerInfo&gt; const&amp; outputLayersInfo,
    NvDsInferNetworkInfo const&amp; networkInfo,
    NvDsInferParseDetectionParams const&amp; detectionParams,
    std::vector&lt;NvDsInferParseObjectInfo&gt;&amp; objectList)&#123;
    
    serial::Serial my_serial(&quot;&#x2F;dev&#x2F;ttyTHS1&quot;, 9600, serial::Timeout::simpleTimeout(50)); &#x2F;&#x2F; è®¾ç½®ä¸²å£
    &#x2F;*if(my_serial.isOpen())&#123;                                                           &#x2F;&#x2F; æµ‹è¯•ä¸²å£æ˜¯å¦æˆåŠŸæ‰“å¼€
        std::cout &lt;&lt; &quot;the location:    X:&quot; &lt;&lt; std::endl;
    &#125;*&#x2F;
    std::vector&lt;Detection&gt; res;

    nms(res, (float*)(outputLayersInfo[0].buffer), CONF_THRESH, NMS_THRESH);
    &#x2F;&#x2F;std::cout&lt;&lt;&quot;Nms done sucessfully----&quot;&lt;&lt;std::endl;
    NvDsInferParseObjectInfo globalbbox;                                                &#x2F;&#x2F; è®¾ç½®ç›®æ ‡æ£€æµ‹åŒºåŸŸ
    globalbbox.classId &#x3D; 0;
    globalbbox.left    &#x3D; static_cast&lt;unsigned int&gt;(160);
    globalbbox.top     &#x3D; static_cast&lt;unsigned int&gt;(120);
    globalbbox.width   &#x3D; static_cast&lt;unsigned int&gt;(320);
    globalbbox.height  &#x3D; static_cast&lt;unsigned int&gt;(240);
    globalbbox.detectionConfidence &#x3D; 0.9;
    objectList.push_back(globalbbox);                                                   &#x2F;&#x2F; å°†ç›®æ ‡æ£€æµ‹åŒºåŸŸå½“ä½œç›®æ ‡ï¼Œä»¥åœ¨è§†é¢‘ä¸­å¾—åˆ°æ˜¾ç¤º
    std::string output &#x3D; &quot;A&quot;;                                                           &#x2F;&#x2F; è®¾ç½®æ ‡å¿—ä½
    unsigned int x &#x3D; 100;                                                               &#x2F;&#x2F; è®¾ç½®åˆå§‹ç›®æ ‡çš„ä¸­å¿ƒ
    unsigned int y &#x3D; 100;
    unsigned int x_temp &#x3D; 0;                                                            &#x2F;&#x2F; è®¾ç½®æš‚å­˜å˜é‡
    unsigned int y_temp &#x3D; 0;
    double confidence_max &#x3D; 0;                                                          &#x2F;&#x2F; æŒ‰ç…§ç½®ä¿¡åº¦è¿›è¡Œä¼˜å…ˆçº§é€‰æ‹©
    for(auto&amp; r : res) &#123;
      NvDsInferParseObjectInfo oinfo;        
      oinfo.classId &#x3D; r.class_id;
            if(oinfo.classId !&#x3D; 0) continue;
      oinfo.left    &#x3D; static_cast&lt;unsigned int&gt;(r.bbox[0]-r.bbox[2]*0.5f);
      oinfo.top     &#x3D; static_cast&lt;unsigned int&gt;(r.bbox[1]-r.bbox[3]*0.5f);
      oinfo.width   &#x3D; static_cast&lt;unsigned int&gt;(r.bbox[2]);
      oinfo.height  &#x3D; static_cast&lt;unsigned int&gt;(r.bbox[3]);
      oinfo.detectionConfidence &#x3D; r.conf;
      x_temp &#x3D; static_cast&lt;unsigned int&gt;(oinfo.left + oinfo.width*0.5f);                &#x2F;&#x2F; è®¡ç®—ç›®æ ‡çš„ä¸­å¿ƒx,y
      y_temp &#x3D; static_cast&lt;unsigned int&gt;(oinfo.top + oinfo.height*0.5f);
      if(x_temp&gt;160 &amp;&amp; x_temp&lt;480 &amp;&amp; y_temp&gt;120 &amp;&amp; y_temp&lt; 360 &amp;&amp; r.conf &gt; confidence_max)&#123;  &#x2F;&#x2F; åˆ¤æ–­ç›®æ ‡ä¸­å¿ƒæ˜¯å¦è½å…¥æ£€æµ‹åŒºåŸŸ
          x &#x3D; x_temp;y &#x3D; y_temp; confidence_max &#x3D; r.conf;
      &#125;
      objectList.push_back(oinfo);        
    &#125;
    output +&#x3D; std::to_string(x);                                                        &#x2F;&#x2F; å°†ä¸²å£è¦å‘é€çš„ä½ç½®ä¿¡æ¯è½¬æ¢ä¸ºåˆé€‚æ ¼å¼
    output +&#x3D; std::to_string(y);
    output +&#x3D; &#39;B&#39;;                                                                      &#x2F;&#x2F; è®¾ç½®åœæ­¢ä½
    std::vector&lt;uint8_t&gt; data(output.begin(), output.end());                            &#x2F;&#x2F; å¯¹æ•°æ®è¿›è¡Œç¼–ç ï¼Œä»¥é…åˆä¸²å£å‘é€ä¿¡æ¯
    &#x2F;&#x2F; std::cout &lt;&lt; data.size() &lt;&lt; std::endl;
    my_serial.write(data.data(), data.size());                                          &#x2F;&#x2F; ä¸²å£å‘é€åæ ‡ä¿¡æ¯
    std::cout &lt;&lt; &quot;the location:    X:&quot; &lt;&lt; x &lt;&lt;&quot;,   Y:&quot; &lt;&lt; y  &lt;&lt; &quot;,   conf:&quot; &lt;&lt; confidence_max &lt;&lt; &quot;,   link:&quot; &lt;&lt; data.data() &lt;&lt; std::endl;  &#x2F;&#x2F; dæ‰“å°å½“å‰ä¸²å£å‘é€çš„åæ ‡ä¿¡æ¯ï¼Œå®é™…ä¸­å¯ä»¥å°†æ­¤è¡Œæ³¨é‡Šæ‰ï¼Œå› ä¸ºprintæ“ä½œä¼šå½±å“ç¨‹åºè¿è¡Œé€Ÿåº¦
    return true;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>å°†ä¸Šè¿°æ¨¡å‹æ ¼å¼è½¬æ¢è¿‡ç¨‹ä¸­ç”Ÿæˆçš„best.engineä¸libmyplugins.soæ–‡ä»¶å¤åˆ¶åˆ°Deepstream5.0è·¯å¾„ä¸‹</li>
<li>ä¿®æ”¹deepstream_app_config_yoloV5.txtæ–‡ä»¶ï¼Œä¿®æ”¹ç»†èŠ‚ä»¥åŠå…·ä½“æ³¨é‡Šå¦‚ä¸‹ï¼š<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">...

[source0]
enable&#x3D;1
#Type - 1&#x3D;CameraV4L2 2&#x3D;URI 3&#x3D;MultiURI
type&#x3D;1   # camera
camera-width&#x3D;640 # ç›¸æœºè·å–è§†é¢‘çš„å®½
camera-height&#x3D;480# ç›¸æœºè·å–è§†é¢‘çš„é«˜
camera-fps-n&#x3D;30  # ç›¸æœºè·å–è§†é¢‘çš„å¸§ç‡åˆ†å­ä¸º30
camera-fps-d&#x3D;1   # ç›¸æœºè·å–è§†é¢‘çš„å¸§ç‡åˆ†æ¯ä¸º1ï¼Œnä¸dé…åˆï¼Œå³30å¸§
#camera-v412-dev-node&#x3D;0
#uri&#x3D;file:&#x2F;opt&#x2F;nvidia&#x2F;deepstream&#x2F;deepstream-5.0&#x2F;samples&#x2F;streams&#x2F;sample_1080p_h264.mp4
#uri&#x3D;file:&#x2F;home&#x2F;nvidia&#x2F;Documents&#x2F;5-Materials&#x2F;Videos&#x2F;0825.avi
num-sources&#x3D;1    # è®¾ç½®è¾“å…¥æºæ•°é‡ï¼Œè¿™é‡Œæ˜¯1ä¸ª
gpu-id&#x3D;0         # è®¾ç½®ä½¿ç”¨çš„GPU IDï¼Œè¿™é‡Œæ˜¯0å·GPU
# (0): memtype_device   - Memory type Device
# (1): memtype_pinned   - Memory type Host Pinned
# (2): memtype_unified  - Memory type Unified
cudadec-memtype&#x3D;0  # è®¾ç½®CUDAè§£ç å™¨ä½¿ç”¨çš„å†…å­˜ç±»å‹ï¼Œè¿™é‡Œæ˜¯Deviceå†…å­˜

...

# è¿™é‡Œæ˜¯é…ç½®ç”Ÿæˆè§†é¢‘æµ
[streammux] 
...
width&#x3D;640
height&#x3D;480
...

...

[primary-gie]
enable&#x3D;1
gpu-id&#x3D;0
model-engine-file&#x3D;best.engine # ç‰©ä½“æ£€æµ‹æ¨¡å‹å¼•æ“æ–‡ä»¶
labelfile-path&#x3D;labels.txt     # æ ‡ç­¾æ–‡ä»¶è·¯å¾„,åŒ…å«ç±»åï¼Œè¿™é‡Œéœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªlabels.txtæ–‡ä»¶
#batch-size&#x3D;1
#Required by the app for OSD, not a plugin property
bbox-border-color0&#x3D;1;0;0;1  # è¾¹ç•Œæ¡†è¾¹æ¡†é¢œè‰²
bbox-border-color1&#x3D;0;1;1;1
bbox-border-color2&#x3D;0;0;1;1
bbox-border-color3&#x3D;0;1;0;1
interval&#x3D;0  # æ¨ç†é—´éš”,å•ä½æ¯«ç§’
gie-unique-id&#x3D;1
nvbuf-memory-type&#x3D;0
config-file&#x3D;config_infer_primary_yoloV5.txt  # åŒ…å«æ›´å¤šè®¾ç½®çš„é…ç½®æ–‡ä»¶

[tracker]
enable&#x3D;0
tracker-width&#x3D;512
tracker-height&#x3D;320
ll-lib-file&#x3D;&#x2F;opt&#x2F;nvidia&#x2F;deepstream&#x2F;deepstream-5.0&#x2F;lib&#x2F;libnvds_mot_klt.so  # æ ¹æ®è‡ªå·±çš„libnvds_mot_klt.soå­˜æ”¾è·¯å¾„è¿›è¡Œæ›´æ”¹ï¼Œä¸€èˆ¬è€Œè¨€ä¸éœ€è¦ä¿®æ”¹æ­¤é¡¹ã€‚å¦‚æœæ˜¯Deepstream5.1ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹ä¸º&#x2F;opt&#x2F;nvidia&#x2F;deepstream&#x2F;deepstream-5.1&#x2F;lib&#x2F;libnvds_mot_klt.so
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>åœ¨Deepstream5.0è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªlabels.txtæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">hole<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
è§£é‡Šï¼šä¸€ä¸ªç›®æ ‡ä¸€è¡Œï¼Œå³è¡¨ç¤ºç´¢å¼•å’Œå†…å®¹</li>
<li>ä¿®æ”¹Makefileæ–‡ä»¶å†…å®¹ï¼Œç»†èŠ‚ä»¥åŠæ³¨é‡Šå¦‚ä¸‹ï¼š<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">CUDA_VER?&#x3D;10.2
ifeq ($(CUDA_VER),)
  $(error &quot;CUDA_VER is not set&quot;)
endif
CC:&#x3D; g++
NVCC:&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-$(CUDA_VER)&#x2F;bin&#x2F;nvcc

CFLAGS:&#x3D; -Wall -std&#x3D;c++11 -shared -fPIC -Wno-error&#x3D;deprecated-declarations
CFLAGS+&#x3D; -I..&#x2F;includes -I&#x2F;usr&#x2F;local&#x2F;cuda-$(CUDA_VER)&#x2F;include -I&#x2F;opt&#x2F;ros&#x2F;melodic&#x2F;include # æ–°å¢çš„ï¼Œä»¥æˆåŠŸåœ¨å¾…ç¼–è¯‘çš„cppæ–‡ä»¶ä¸­å¼•å…¥&lt;serial&#x2F;serial.h&gt;å¤´æ–‡ä»¶

LIBS:&#x3D; -lnvinfer_plugin -lnvinfer -lnvparsers -L&#x2F;usr&#x2F;local&#x2F;cuda-$(CUDA_VER)&#x2F;lib64 -lcudart -lcublas -lstdc++fs -L&#x2F;opt&#x2F;ros&#x2F;melodic&#x2F;lib -lserial  # æ–°å¢çš„ï¼Œé“¾æ¥åº“æ–‡ä»¶&#x2F;opt&#x2F;ros&#x2F;melodic&#x2F;lib&#x2F;libserial.soï¼Œä»¥å®ç°ä¸²å£é€šä¿¡ã€‚
LFLAGS:&#x3D; -shared -Wl,--start-group $(LIBS) -Wl,--end-group

INCS:&#x3D; $(wildcard *.h) 
SRCFILES:&#x3D; nvdsinfer_yolo_engine.cpp \
          nvdsparsebbox_Yolo.cpp   \
          trt_utils.cpp              \
          #  yolo.cpp              \  # æ³¨é‡Šæ‰è¿™ä¸¤è¡Œï¼Œå› ä¸ºä½¿ç”¨ä¸åˆ°ï¼Œå¹¶ä¸”ä½¿ç”¨çš„è¯ä¼šå¯¼è‡´æ— æ³•é¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚
          #  yoloPlugins.cpp          # æ³¨é‡Šæ‰è¿™ä¸¤è¡Œ
TARGET_LIB:&#x3D; libnvdsinfer_custom_impl_Yolo.so
#TARGET_LIB:&#x3D; libnvdsinfer_custom_impl_Yolo.so
TARGET_OBJS:&#x3D; $(SRCFILES:.cpp&#x3D;.o)
TARGET_OBJS:&#x3D; $(TARGET_OBJS:.cu&#x3D;.o)

all: $(TARGET_LIB)

%.o: %.cpp $(INCS) Makefile
  $(CC) -c -o $@ $(CFLAGS) $&lt;

%.o: %.cu $(INCS) Makefile
  $(NVCC) -c -o $@ --compiler-options &#39;-fPIC&#39; $&lt;

$(TARGET_LIB) : $(TARGET_OBJS)
  $(CC) -o $@  $(TARGET_OBJS) $(LFLAGS)

clean:
  rm -rf $(TARGET_LIB)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
ä¸Šè¿°å…·ä½“è§£é‡Šå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼Œé‡Œé¢è¯¦ç»†è®°å½•äº†ç›¸å…³å†…å®¹ï¼š<a href="https://sprli.github.io/2023/05/26/Cmake_Study/">https://sprli.github.io/2023/05/26/Cmake_Study/</a></li>
</ul>
<h4 id="è¿è¡ŒåŠä½¿ç”¨">è¿è¡ŒåŠä½¿ç”¨</h4>
<h3 id="å¦‚ä½•å®ç°ç¨‹åºè‡ªå¯åŠ¨">å¦‚ä½•å®ç°ç¨‹åºè‡ªå¯åŠ¨</h3>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/06/19/github_command/" title="GitHubæ“ä½œå¸¸ç”¨æŒ‡ä»¤"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: GitHubæ“ä½œå¸¸ç”¨æŒ‡ä»¤</span></a><a class="button is-default" href="/2023/05/26/Cmake_Study/" title="cmakeå­¦ä¹ è®°å½•"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: cmakeå­¦ä¹ è®°å½•</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Sprli/Sprli.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article><article class="mt-6 comment-container" id="vcomments"></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Sprli"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> æç¥–ä¹ 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>